<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCA Yield Curve Stress Testing</title>

    <!-- External Libraries -->
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header>
            <h1>üìä PCA Yield Curve Stress Testing</h1>
            <p class="subtitle">Deriving Stress Scenarios from Yield Curves using Principal Component Analysis</p>
        </header>

        <!-- Documentation Section -->
        <div class="documentation-section">
            <div class="documentation-toggle-container">
                <button onclick="toggleDocumentation()" class="documentation-btn">
                    üìñ Dokumentation & Methodologie
                </button>
            </div>

            <div id="documentationContent" style="display: none;">
                <div class="doc-content">
                    <h3><span>üìñ</span> √úberblick</h3>
                    <p>
                        Diese Web-App f√ºhrt eine Hauptkomponentenanalyse (PCA) der Zinsstrukturkurve durch, um Stressszenarien f√ºr Stresstests abzuleiten.
                        Im Rahmen der Bewertung von Aktiva und Passiva √ºber ihre zuk√ºnftigen Cashflows sind Zinsstrukturkurven von gr√∂√üter Bedeutung.
                        Die Zinsstrukturkurve zu einem bestimmten Zeitpunkt besteht aus mehreren Spot Rates f√ºr unterschiedliche Laufzeiten.
                        Die Bewegung der Spot Rates √ºber die Zeit f√ºr die verschiedenen Laufzeiten ist stark korreliert.
                        Um Stressszenarien erstellen zu k√∂nnen, ist es entscheidend zu verstehen, wie sich die verschiedenen Spot Rates gemeinsam bewegen.
                    </p>

                    <h3><span>üìä</span> Die Daten</h3>
                    <p>
                        Die Zinsstrukturkurve √ºber den Zeitverlauf kann als dreidimensionale Fl√§che dargestellt werden, wobei die x-Achse die Zeit,
                        die y-Achse die Laufzeit und die z-Achse den entsprechenden Spot Rate darstellt. Die Daten werden von der
                        <strong>Europ√§ischen Zentralbank (ECB)</strong> bezogen und zeigen die Euro-Zinsstrukturkurve.
                    </p>

                    <h3><span>‚öñÔ∏è</span> Regulatorischer Kontext</h3>
                    <p>
                        Viele regulatorische Ans√§tze betonen die Bedeutung des Zinsrisikos. Die Solvency II Standardformel verlangt
                        ein Aufw√§rts- und ein Abw√§rtsszenario der Zinsstrukturkurve, die jeweils zu einer Neubewertung der zuk√ºnftigen
                        Cashflows aus Aktiva und Passiva f√ºhren. Die International Association of Insurance Supervisors (IAIS) schl√§gt
                        mehrere Stressszenarien vor, die das Niveau, die Steigung und die Kr√ºmmung der Zinsstrukturkurve ver√§ndern.
                    </p>

                    <h3><span>üî¨</span> Technisches Setup</h3>
                    <p>
                        Die PCA reduziert hochkorrelierte und hochdimensionale Daten auf niedrigdimensionale Daten mit angemessener Approximation.
                        Die Hauptkomponenten bilden ein orthonormales Basissystem eines neuen Koordinatensystems:
                    </p>
                    <ul>
                        <li><strong>PC1 (Level):</strong> Erkl√§rt typischerweise den Gro√üteil der Varianz und repr√§sentiert das Niveau der Zinskurve</li>
                        <li><strong>PC2 (Slope):</strong> Repr√§sentiert die Steigung der Zinskurve</li>
                        <li><strong>PC3 (Curvature):</strong> Repr√§sentiert die Kr√ºmmung der Zinskurve</li>
                    </ul>
                    <p>
                        Die ersten drei Hauptkomponenten erkl√§ren typischerweise √ºber 99% der Gesamtvarianz in den Bewegungen der Zinsstrukturkurve.
                        Zur Erstellung eines Stressszenarios werden die Scores der Hauptkomponenten mit gestressten Werten (z.B. 99,5%-Quantile) ersetzt
                        und die PCA invertiert, um eine gestresste Zinsstrukturkurve zu erhalten.
                    </p>

                    <h3><span>üí≠</span> Diskussion</h3>
                    <div class="discussion-grid">
                        <div class="pro-section">
                            <h4>‚úÖ Vorteile</h4>
                            <ul>
                                <li>PCA ist eine effektive Methode zur Darstellung hochdimensionaler Daten mit wenigen erkl√§renden Variablen</li>
                                <li>Vereinfachte Modellierung der Zinsstrukturkurve mit nur wenigen unkorrelierten Zufallsvariablen</li>
                                <li>PCA ist eine nicht-parametrische Methode, daher sind keine Annahmen √ºber die Verteilung erforderlich</li>
                                <li>Erm√∂glicht die Erstellung von Aufw√§rts-/Abw√§rts-Stressszenarien f√ºr Niveau, Steigung und Kr√ºmmung</li>
                            </ul>
                        </div>
                        <div class="contra-section">
                            <h4>‚ö†Ô∏è Nachteile & Einschr√§nkungen</h4>
                            <ul>
                                <li>PCA ist eine Korrelationsanalyse, daher ist eine station√§re Zeitreihe erforderlich</li>
                                <li>Die erkl√§rte Varianz ist das einzige Kriterium f√ºr die Auswahl der Hauptkomponenten</li>
                                <li>Tail-Ereignisse, die f√ºr Stresstests verwendet werden, sind nur lineare Kombinationen der gew√§hlten Hauptkomponenten</li>
                                <li>Die Ergebnisse sind nicht stabil √ºber die Zeit, da sich die Aufsichtsma√ünahmen √§ndern k√∂nnen</li>
                                <li>Implizite Annahme, dass zuk√ºnftige Tail-Ereignisse die vergangenen nicht √ºberschreiten werden</li>
                            </ul>
                        </div>
                    </div>

                    <h3><span>üìö</span> Weitere Informationen</h3>
                    <p>
                        Eine ausf√ºhrliche Dokumentation mit mathematischen Details, Literaturverweisen und technischen Spezifikationen
                        finden Sie im <a href="https://github.com/bt1985/pca_spotrates" target="_blank">GitHub Repository</a>.
                    </p>
                </div>
            </div>
        </div>

        <!-- Controls Section -->
        <div class="controls">
            <div class="form-group">
                <div class="input-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate" value="2023-12-26" onchange="validateDates()">
                    <div class="validation-error" id="startDateError"></div>
                </div>
                <div class="input-group">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate" onchange="validateDates()">
                    <div class="validation-error" id="endDateError"></div>
                </div>
                <button id="analyzeBtn" onclick="performAnalysis()">Generate Stress Scenarios</button>
            </div>

            <div class="advanced-toggle-container">
                <button onclick="toggleAdvancedOptions()" class="advanced-btn">
                    ‚öôÔ∏è Advanced Options
                </button>
            </div>

            <!-- Advanced Options -->
            <div id="advancedOptions" style="display: none;">
                <h3><span>‚öôÔ∏è</span> Advanced Configuration</h3>
                <div class="form-group">
                    <div class="input-group">
                        <label for="nComponents">Number of PCs</label>
                        <input type="number" id="nComponents" value="3" min="1" max="10">
                        <small>Number of principal components to compute (1-10)</small>
                    </div>
                    <div class="input-group">
                        <label for="stressQuantile">Stress Quantile</label>
                        <input type="number" id="stressQuantile" value="0.995" min="0.9" max="0.999" step="0.001">
                        <small>Quantile for stress testing (0.9 = 90%, 0.995 = 99.5%)</small>
                    </div>
                    <div class="input-group">
                        <label for="rollingWindow">Rolling Window (months)</label>
                        <input type="number" id="rollingWindow" value="24" min="6" max="60">
                        <small>Window size for rolling quantile (6-60 months)</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Warning Box -->
        <div class="warning" id="warningBox"></div>

        <!-- Error Box -->
        <div class="error" id="errorBox"></div>

        <!-- Loading Indicator -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing yield curve data from ECB...</p>
            <p style="font-size: 0.9em; color: #6c757d; margin-top: 10px;">This may take a few moments</p>
        </div>

        <!-- Results Section -->
        <div class="results" id="results">
            <!-- Statistics Cards -->
            <div class="stats" id="stats"></div>

            <!-- Export Buttons -->
            <div class="export-section">
                <button class="export-btn" onclick="exportData('csv')">
                    üìÑ Export CSV
                </button>
                <button class="export-btn" onclick="exportData('excel')">
                    üìä Export Excel
                </button>
            </div>

            <!-- Yield Curve Evolution -->
            <div class="section">
                <h2 class="section-title">Yield Curve Evolution</h2>
                <p class="description">
                    The 3D surface shows the evolution of the Euro area yield curve over time.
                    Data is sourced from the ECB Statistical Data Warehouse.
                </p>
                <div class="plot-container" id="yieldCurvePlot"></div>
            </div>

            <!-- Principal Components -->
            <div class="section">
                <h2 class="section-title">Principal Components</h2>
                <p class="description">
                    The first principal components explain most of the yield curve variation.
                    PC1 represents the level, PC2 the slope, and PC3 the curvature.
                </p>
                <div class="plot-container" id="pcPlot"></div>
            </div>

            <!-- Explained Variance -->
            <div class="section">
                <h2 class="section-title">Explained Variance</h2>
                <p class="description">
                    The first three principal components typically explain over 99% of the total variance in yield curve movements.
                </p>
                <div class="plot-container" id="variancePlot"></div>
            </div>

            <!-- Stressed Scores -->
            <div class="section">
                <h2 class="section-title">Stressed Scores</h2>
                <p class="description">
                    Rolling 99.5% quantiles of the principal component scores.
                    These are used to generate adverse scenarios for stress testing.
                </p>
                <div class="plot-container" id="stressedScoresPlot"></div>
            </div>

            <!-- Stress Scenarios -->
            <div class="section">
                <h2 class="section-title">Yield Curve Stress Scenarios</h2>
                <p class="description">
                    Stressed yield curves generated by applying the quantile stresses to each principal component individually.
                </p>
                <div class="plot-container" id="scenariosPlot"></div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Powered by ECB Data | Principal Component Analysis |
            <a href="https://github.com/bt1985/pca_spotrates" target="_blank">GitHub Repository</a></p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
