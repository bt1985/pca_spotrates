<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCA Yield Curve Stress Testing</title>

    <!-- External Libraries -->
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header>
            <h1>üìä PCA Yield Curve Stress Testing</h1>
            <p class="subtitle">Deriving Stress Scenarios from Yield Curves using Principal Component Analysis</p>
        </header>

        <!-- Controls Section -->
        <div class="controls">
            <div class="form-group">
                <div class="input-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate" value="2023-12-26" onchange="validateDates()">
                    <div class="validation-error" id="startDateError"></div>
                </div>
                <div class="input-group">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate" onchange="validateDates()">
                    <div class="validation-error" id="endDateError"></div>
                </div>
                <button id="analyzeBtn" onclick="performAnalysis()">Generate Stress Scenarios</button>
            </div>

            <div class="advanced-toggle-container">
                <button onclick="toggleAdvancedOptions()" class="advanced-btn">
                    ‚öôÔ∏è Advanced Options
                </button>
            </div>

            <!-- Advanced Options -->
            <div id="advancedOptions" style="display: none;">
                <h3><span>‚öôÔ∏è</span> Advanced Configuration</h3>
                <div class="form-group">
                    <div class="input-group">
                        <label for="nComponents">Number of PCs</label>
                        <input type="number" id="nComponents" value="3" min="1" max="10">
                        <small>Number of principal components to compute (1-10)</small>
                    </div>
                    <div class="input-group">
                        <label for="stressQuantile">Stress Quantile</label>
                        <input type="number" id="stressQuantile" value="0.995" min="0.9" max="0.999" step="0.001">
                        <small>Quantile for stress testing (0.9 = 90%, 0.995 = 99.5%)</small>
                    </div>
                    <div class="input-group">
                        <label for="rollingWindow">Rolling Window (months)</label>
                        <input type="number" id="rollingWindow" value="24" min="6" max="60">
                        <small>Window size for rolling quantile (6-60 months)</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Warning Box -->
        <div class="warning" id="warningBox"></div>

        <!-- Error Box -->
        <div class="error" id="errorBox"></div>

        <!-- Loading Indicator -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing yield curve data from ECB...</p>
            <p style="font-size: 0.9em; color: #6c757d; margin-top: 10px;">This may take a few moments</p>
        </div>

        <!-- Results Section -->
        <div class="results" id="results">
            <!-- Statistics Cards -->
            <div class="stats" id="stats"></div>

            <!-- Export Buttons -->
            <div class="export-section">
                <button class="export-btn" onclick="exportData('csv')">
                    üìÑ Export CSV
                </button>
                <button class="export-btn" onclick="exportData('excel')">
                    üìä Export Excel
                </button>
            </div>

            <!-- Yield Curve Evolution -->
            <div class="section">
                <h2 class="section-title">Yield Curve Evolution</h2>
                <p class="description">
                    The 3D surface shows the evolution of the Euro area yield curve over time.
                    Data is sourced from the ECB Statistical Data Warehouse.
                </p>
                <div class="plot-container" id="yieldCurvePlot"></div>
            </div>

            <!-- Principal Components -->
            <div class="section">
                <h2 class="section-title">Principal Components</h2>
                <p class="description">
                    The first principal components explain most of the yield curve variation.
                    PC1 represents the level, PC2 the slope, and PC3 the curvature.
                </p>
                <div class="plot-container" id="pcPlot"></div>
            </div>

            <!-- Explained Variance -->
            <div class="section">
                <h2 class="section-title">Explained Variance</h2>
                <p class="description">
                    The first three principal components typically explain over 99% of the total variance in yield curve movements.
                </p>
                <div class="plot-container" id="variancePlot"></div>
            </div>

            <!-- Stressed Scores -->
            <div class="section">
                <h2 class="section-title">Stressed Scores</h2>
                <p class="description">
                    Rolling 99.5% quantiles of the principal component scores.
                    These are used to generate adverse scenarios for stress testing.
                </p>
                <div class="plot-container" id="stressedScoresPlot"></div>
            </div>

            <!-- Stress Scenarios -->
            <div class="section">
                <h2 class="section-title">Yield Curve Stress Scenarios</h2>
                <p class="description">
                    Stressed yield curves generated by applying the quantile stresses to each principal component individually.
                </p>
                <div class="plot-container" id="scenariosPlot"></div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Powered by ECB Data | Principal Component Analysis |
            <a href="https://github.com/bt1985/pca_spotrates" target="_blank">GitHub Repository</a></p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
